# NeoLight Android Controller

Пример приложения под Android на JAVA для управления светодиодной RGB лентой, подключенной к arduino по bluetooth.
**Disclamer:**
Первая "проба пера" разработки под Android, так что код далек от совершенства и не претендует на прямое его использование, а лишь демонстрирует, как можно подключится к Arduino по Bluetooth и отправлять команды.

## Принцип работы
При разработке данного приложения столкнулся с некоторыми трудностями, решение которых заняло существенное время. Ниже привожу пример того, как я их решил.
Поскольку я по специальности PHP backend разработчик, было решено реализовать интерфейс этого приложения на привычном мне Bootstrap 4 и просто обернуть в WebView. Весь его код лежит в папке **\app\src\main\assets**.
**Внимание!** Это специальная служебная папка для хранения ресурсов приложения, из JAVA-кода обращение к ней идет как
```JAVA
 webView.loadUrl("file:///android_asset/index.html");
```
Также внутри сохраненных там HTML-файлов **НЕ РАБОТАЮТ АБСОЛЮТНЫЕ ПУТИ** до картинок, css и js файлов, etc. Необходимо указывать пути относительно конкретного HTML-файла.

Общение между WebView и JAVA происходит при помощи класса WebAppInterface, реализующего  **android.webkit.JavascriptInterface**

Процесса поиска и сопряжения bluetooth-устройств в приложении не происходит - это необходимо делать стандартными средствами ОС Android. Метод **searchDecice()** лишь ищет в спареных устройствах устройство с названием "HC-05" (стандартное название использующегося bluetooth модуля для arduino) и возвращает JSON с его MAC-адресом, а так же сразу открывает до него сокет и кладет его дескриптор в 
```JAVA
    private Map<String,BluetoothSocket> sockets = new HashMap<String, BluetoothSocket>();
```
с ключем в виде MAC-адреса устройства.

Метод **SendColor()** получает из WebView JSON с закодированным для Arduino цветом и адресом(ами) устройств, на который необходимо отправить команду, после чего извлекает сокет устройства из HashMap и отправляет данные через объект **OutputStream tmpOut**
```JAVA
       socket = this.sockets.get(device.getAddress());
       tmpOut = socket.getOutputStream();
       tmpOut.write(value.getBytes());
```
Формат команд для Arduino повзаимствован у Алекса Гайвера: https://alexgyver.ru/

##Видео с примером работы приложения:
[![IMAGE ALT TEXT HERE](https://img.youtube.com/vi/j7oKXfXjlNY/0.jpg)](https://www.youtube.com/watch?v=j7oKXfXjlNY)